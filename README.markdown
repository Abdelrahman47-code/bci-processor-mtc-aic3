# BCI Processor

A modular Python package for processing and classifying EEG signals for Brain-Computer Interface (BCI) applications, developed for the MTC-AIC-3: Egypt National Artificial Intelligence Competition. The system supports Motor Imagery (MI) and Steady-State Visually Evoked Potential (SSVEP) tasks, achieving robust performance through advanced preprocessing, feature extraction, and machine learning techniques.

## Overview

The `bci-processor` package provides an end-to-end pipeline for EEG signal classification, designed for the MTC-AIC-3 competition. It processes EEG data from the competition dataset, extracts features using Filter Bank Common Spatial Patterns (FBCSP) for MI and extended Canonical Correlation Analysis (CCA) for SSVEP, and trains models using Linear Discriminant Analysis (LDA) for MI and Gradient Boosting with hyperparameter tuning for SSVEP. The system is fully reproducible, configurable via a YAML file, and includes unit tests and model checkpoints.

### Key Features
- **Modular Design**: Separate modules for preprocessing, feature extraction, and modeling.
- **Preprocessing**: Subject-specific normalization, ICA-based artifact removal, notch and bandpass filtering.
- **Feature Extraction**:
  - MI: Time-domain, frequency-domain, wavelet, FBCSP, and cross-channel features.
  - SSVEP: Frequency-domain, extended CCA, SNR, and phase features.
- **Modeling**: LDA for MI, Gradient Boosting with RandomizedSearchCV for SSVEP.
- **Configuration**: Parameters managed via `config.yaml`.
- **Reproducibility**: Includes model checkpoints, dependencies, and a CLI script.
- **Testing**: Unit tests with `pytest` for validation.
- **Logging**: Comprehensive logging for debugging and monitoring.

## Installation

### Prerequisites
- Python 3.8 or higher
- Git
- A LaTeX distribution (e.g., TeX Live) for compiling the system description (optional)

### Steps
1. **Clone the Repository**:
   ```bash
   git clone https://github.com/yourusername/bci-processor.git
   cd bci-processor
   ```

2. **Create a Virtual Environment**:
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # On Windows: .venv\Scripts\activate
   ```

3. **Install Dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Install the Package**:
   ```bash
   pip install .
   ```

## Usage

### Running the Pipeline
The pipeline can be executed via the command-line interface (CLI) script:
```bash
python scripts/run_bci_processor.py --config bci_processor/config.yaml --output submission.csv --log-level INFO
```

This command:
- Trains MI and SSVEP models on the training data.
- Generates predictions for the test set in `submission.csv`.
- Logs progress and results to the console and `bci_processor.log`.

### Configuration
Edit `bci_processor/config.yaml` to customize parameters:
- **Data**: Dataset path, sampling rate, EEG channels.
- **Preprocessing**: Frequency bands, notch filter settings, ICA components.
- **Feature Extraction**: Wavelet settings, CSP filters, target frequencies for SSVEP.
- **Modeling**: Model types and hyperparameter search space.

### Generating Model Checkpoints
To save model checkpoints for reproducibility:
```bash
python save_checkpoints.py
```
This creates a `checkpoints/` directory with `.pkl` files for models, scalers, and feature selectors.

### Testing
Run unit tests to validate the code:
```bash
pytest tests/
```
Note: Some tests may require mock EEG data, as they depend on the competition dataset.

## Repository Structure
```
bci-processor/
├── bci_processor/          # Core Python package
│   ├── __init__.py
│   ├── config.yaml         # Configuration file
│   ├── preprocessing.py    # Data loading and preprocessing
│   ├── feature_extraction.py # Feature extraction for MI and SSVEP
│   ├── modeling.py         # Model training and prediction
│   ├── processor.py        # Main integration class
│   └── utils.py            # Utility functions (logging, config loading)
├── tests/                  # Unit tests
│   ├── __init__.py
│   ├── test_preprocessing.py
│   ├── test_feature_extraction.py
│   └── test_modeling.py
├── scripts/                # CLI scripts
│   └── run_bci_processor.py
├── .gitignore              # Git ignore file
├── README.md               # This file
├── requirements.txt        # Dependencies
├── LICENSE                 # MIT License
├── setup.py               # Package installation script
└── .github/
    └── workflows/
        └── ci.yml          # GitHub Actions for CI/CD
```

## MTC-AIC-3 Submission
This package was developed for the MTC-AIC-3 competition. The submission includes:
- **System Description Paper**: `system_description.pdf` (in LaTeX, compile with `pdflatex system_description.tex`).
- **Test Set Predictions**: `submission.csv`, generated by the CLI script.
- **Code and Checkpoints**:
  - Full codebase for preprocessing, training, and inference.
  - Model checkpoints in `checkpoints/` for reproducibility.
  - Configuration in `config.yaml` and dependencies in `requirements.txt`.

To reproduce the submission:
1. Install dependencies and the package as described above.
2. Ensure the competition dataset is available at the path specified in `config.yaml`.
3. Run the CLI script to train models and generate predictions.
4. Use `save_checkpoints.py` to generate model checkpoints.

## Performance
Approximate validation accuracies:
- **MI**: 0.65–0.70
- **SSVEP**: 0.55–0.60
- **Overall**: 0.60–0.65

## Challenges and Solutions
- **CSP Indexing Error**: Fixed by using trial-specific covariance matrices, removing label dependency during testing.
- **Noisy EEG Data**: Addressed with ICA-based artifact removal and robust scaling.
- **SSVEP Performance**: Improved with extended CCA (phase-shifted references) and hyperparameter tuning.

## Contributing
Contributions are welcome! Please:
1. Fork the repository.
2. Create a feature branch (`git checkout -b feature/your-feature`).
3. Commit changes (`git commit -m "Add your feature"`).
4. Push to the branch (`git push origin feature/your-feature`).
5. Open a pull request.

## License
This project is licensed under the MIT License. See `LICENSE` for details.

## Contact
- **Team Name**: YourTeamName
- **Team Leader**: Your Full Name
- **Email**: your.email@example.com
- **GitHub**: https://github.com/yourusername/bci-processor

For competition-related inquiries:
- Technical: competition@aic.gov.eg
- Administrative: competition@mtc.edu.eg

Thank you for exploring `bci-processor`! We hope this package provides a robust foundation for EEG-based BCI research.